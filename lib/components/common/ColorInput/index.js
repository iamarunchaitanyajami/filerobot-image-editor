import _defineProperty from"@babel/runtime/helpers/defineProperty";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import React,{useEffect,useRef,useState}from"react";import{useStore}from"../../../hooks";import{SET_LATEST_COLOR}from"../../../actions";import ColorPickerModal from"../ColorPickerModal";import{StyledPickerTrigger}from"./ColorInput.styled";var pinnedColorsKey="FIE_pinnedColors",ColorInput=function(a){var b,c=a.onChange,d=a.color,e=void 0===d?void 0:d,f=a.colorFor,g=useStore(),h=g.selectionsIds,i=void 0===h?[]:h,j=g.config.annotationsCommon,k=void 0===j?{}:j,l=g.dispatch,m=g.latestColors,n=void 0===m?{}:m,o=n[f],p=useState(),q=_slicedToArray(p,2),r=q[0],s=q[1],t=useState(function(){return o||e||k.fill}),u=_slicedToArray(t,2),v=u[0],w=u[1],x=useState(null!==(b=window)&&void 0!==b&&b.localStorage?JSON.parse(localStorage.getItem(pinnedColorsKey)||"[]"):[]),y=_slicedToArray(x,2),z=y[0],A=y[1],B=useRef(v),C=function(a){var b;if(null!==(b=window)&&void 0!==b&&b.localStorage){var c=window.localStorage.getItem(pinnedColorsKey);if(JSON.stringify(a)!==c){var d=a.slice(-9);window.localStorage.setItem(pinnedColorsKey,JSON.stringify(d)),A(d)}}},D=function(a){s(r?null:a.currentTarget)};return useEffect(function(){var a=0===i.length&&o||e;w(a),c(a)},[e,i]),React.createElement(React.Fragment,null,React.createElement(StyledPickerTrigger,{className:"FIE_color-picker-triggerer",onClick:D,$color:v,onChange:c}),React.createElement(ColorPickerModal,{hideModalTitle:!0,onChange:function changeColor(a,b,d){w(b),c(b),C(d),o!==b&&l({type:SET_LATEST_COLOR,payload:{latestColors:_defineProperty({},f,b)}})},defaultColor:v,pinnedColors:z,open:!!r,onClose:function closePicker(a){c(B.current||v),D(a)},onApply:D}))};export default ColorInput;