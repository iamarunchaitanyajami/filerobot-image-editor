import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _defineProperty from"@babel/runtime/helpers/defineProperty";import React,{useCallback,useEffect}from"react";import MenuItem from"@scaleflex/ui/core/menu-item";import FontBold from"@scaleflex/icons/font-bold";import FontItalic from"@scaleflex/icons/font-italic";import{TOOLS_IDS,TRANSFORMERS_LAYER_ID}from"../../../../utils/constants";import AnnotationOptions from"../../../common/AnnotationOptions";import{StyledIconWrapper}from"../../../common/AnnotationOptions/AnnotationOptions.styled";import{ENABLE_TEXT_CONTENT_EDIT}from"../../../../actions";import restrictNumber from"../../../../utils/restrictNumber";import{useStore}from"../../../../hooks";import{StyledFontFamilySelect,StyledFontSizeInput,StyledToolsWrapper}from"./TextOptions.styled";import{textOptionsPopupComponents,TEXT_POPPABLE_OPTIONS}from"./TextOptions.constants";import{activateTextChange,deactivateTextChange}from"./handleTextChangeArea";var TextControls=function(a){var b=a.text,c=a.saveText,d=a.children,e=void 0===d?null:d,f=useStore(),g=f.dispatch,h=f.textIdOfEditableContent,i=f.designLayer,j=f.t,k=f.config,l=k.useCloudimage,m=k[TOOLS_IDS.TEXT],n=m.fonts,o=void 0===n?[]:n,p=m.onFontChange,q=useCallback(function(a){var b=a.target,d=b.name,e=b.value,f=b.type;c(function(a){return _defineProperty({id:a.id},d,"number"===f?restrictNumber(e,1,500):e)})},[c]),r=useCallback(function(a){if(q({target:{name:"fontFamily",value:a}}),b.fontFamily!==a&&"function"==typeof p){var c=i.draw.bind(i);p(a,c)}},[q,b,i]),s=useCallback(function(a){var c,d=(null===(c=b.fontStyle)||void 0===c?void 0:c.replace("normal","").split(" "))||[];0<Object.keys(d).length&&d.includes(a)?d=d.filter(function(b){return b!==a}):d.push(a),q({target:{name:"fontStyle",value:d.join(" ").trim()||"normal"}})},[b]),t=useCallback(function(){g({type:ENABLE_TEXT_CONTENT_EDIT,payload:{textIdOfEditableContent:null}})},[]),u=useCallback(function(a){q({target:{name:"text",value:a}}),t()},[]);return useEffect(function(){var a;if(h&&b.id===h){var c=i.getStage(),d=_slicedToArray(c.findOne("#".concat(TRANSFORMERS_LAYER_ID)).children,1);a=d[0],activateTextChange(h,c,a,u,t)}return function(){a&&h&&deactivateTextChange()}},[h]),React.createElement(AnnotationOptions,{className:"FIE_text-tool-options",annotation:b,updateAnnotation:c,morePoppableOptionsPrepended:l?[]:TEXT_POPPABLE_OPTIONS,moreOptionsPopupComponentsObj:l?{}:textOptionsPopupComponents,t:j},Array.isArray(o)&&1<o.length&&React.createElement(StyledFontFamilySelect,{className:"FIE_text-font-family-option",onChange:r,value:b.fontFamily,placeholder:j("fontFamily"),size:"sm"},o.map(function(){var a,b,c,d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return React.createElement(MenuItem,{className:"FIE_text-font-family-item",key:null!==(a=d.value)&&void 0!==a?a:d,value:null!==(b=d.value)&&void 0!==b?b:d},null!==(c=d.label)&&void 0!==c?c:d)})),React.createElement(StyledFontSizeInput,{className:"FIE_text-size-option",value:b.fontSize||"",name:"fontSize",onChange:q,inputMode:"numeric",type:"number",size:"sm",placeholder:j("size")}),React.createElement(StyledToolsWrapper,null,!l&&React.createElement(React.Fragment,null,React.createElement(StyledIconWrapper,{className:"FIE_text-bold-option",active:(b.fontStyle||"").includes("bold"),onClick:function onClick(){return s("bold")},watermarkTool:!0},React.createElement(FontBold,{size:20})),React.createElement(StyledIconWrapper,{className:"FIE_text-italic-option",active:(b.fontStyle||"").includes("italic"),onClick:function onClick(){return s("italic")},watermarkTool:!0},React.createElement(FontItalic,{size:20}))),e))};export default TextControls;